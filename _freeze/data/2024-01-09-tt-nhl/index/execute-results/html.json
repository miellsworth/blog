{
  "hash": "4b5d77bdc30a978b95dd79c6e09e69f7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Notes on Tidy Tuesday - 2024-01-09\"\ndescription: |\n  \ndate: 2024-01-09\n---\n\n\n# Plot\n![NHL birthdays vs. general population](https://raw.githubusercontent.com/miellsworth/tidytuesday/refs/heads/main/2024/2024-01-09/2024-01-09_proportion_comparison.png)\n\n# Notes\n- placeholder\n\n# Source code\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```{.sourceCode .r}\n# Load libraries\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(tidytuesdayR)\nlibrary(here)\nlibrary(forcats)\nlibrary(cowplot)\nlibrary(stringr)\n\n# Find the most recent Tuesday\ntidytuesdayR::last_tuesday()\nlast_tues <- \"2024-01-09\"\n\n# View README\ntt_output <- tt_load_gh(last_tues)\nreadme(tt_output)\n\n# Creating directory for draft plots\nplt_dir <- paste0(\"plt_\", last_tues)\n# dir.create(here(\"plots\", \"drafts\", plt_dir))\n\n# Get the Data\ntuesdata <- tidytuesdayR::tt_load(last_tues)\n\n# Tidy data\ncan_births <- tuesdata$canada_births_1991_2022\nnhl_births <- tuesdata$nhl_player_births\n\n# Transform data\ncan_monthly_births <- can_births %>% \n  group_by(month) %>%\n  summarise(total_monthly_births = sum(births)) %>%\n  mutate(monthly_proportion = total_monthly_births/sum(total_monthly_births)) %>%\n  mutate(sample = \"gen_pop\")\n\nnhl_monthly_births <- nhl_births %>% count(birth_month) %>%\n  mutate(monthly_proportion = n/sum(n)) %>%\n  rename(\n    total_monthly_births = n,\n    month = birth_month\n  ) %>%\n  mutate(sample = \"nhl\")\n\nmonthly_births <- rbind(can_monthly_births, nhl_monthly_births) %>%\n  mutate(num_month = month) %>%\n  mutate(month = month.abb[month])\n\nmonthly_birth_diffs <- monthly_births %>% \n  pivot_wider(\n    id_cols = c(month, num_month),\n    values_from = c(total_monthly_births, monthly_proportion),\n    names_from = sample\n  ) %>%\n  mutate(prop_diff = monthly_proportion_nhl - monthly_proportion_gen_pop) %>%\n  mutate(positive = if_else(prop_diff >= 0, TRUE, FALSE))\nmonthly_birth_diffs\n\n# Plot data\nplot <- monthly_birth_diffs %>%\n  ggplot(aes(x = fct_inorder(month), y = monthly_proportion_gen_pop)) +\n  geom_rect(\n    aes(\n      x = fct_inorder(month),\n      xmin = num_month - 0.45,\n      xmax = num_month + 0.45,\n      ymin = monthly_proportion_gen_pop,\n      ymax = monthly_proportion_gen_pop + prop_diff,\n      fill = positive\n    )\n  ) +\n  geom_col(\n    aes(\n      x = fct_inorder(month), \n      y = monthly_proportion_gen_pop,\n      ),\n    color = \"black\",\n    size = 1,\n    alpha = 0.2\n  ) +\n  scale_fill_manual(\n    values = c(\"#FF6962\", \"#5BB300\"),\n    labels = c(\"Lower\", \"Higher\"),\n    name = \"Relative Proportion of NHL birth months\"\n  ) +\n  scale_y_continuous(\n    labels = scales::percent,\n    limits = c(0, NA),\n    expand = c(0, 0)\n  ) +\n  ylab(\"Births per month\") +\n  xlab(element_blank()) +\n  labs(\n    title = str_wrap(\"Relative to the general population, NHL players are born more often in the first 5 months of the year\", width = 80)\n  ) +\n  theme_classic() +\n  theme(\n    axis.ticks.x = element_blank(),\n    axis.ticks.y = element_blank(),\n    text = element_text(size = 13),\n    legend.position = \"none\",\n    panel.background = element_rect(fill = \"#fbfae4\"),\n    plot.background = element_rect(fill = \"#fbfae4\"),\n  )\n\nplot\n\nplot2 <- monthly_birth_diffs %>%\n  ggplot(aes(x = fct_inorder(month), y = prop_diff, fill = positive)) +\n  geom_col() +\n  scale_fill_manual(\n    values = c(\"#FF6962\", \"#5BB300\"),\n    labels = c(\"Lower\", \"Higher\"),\n    name = \"Relative birth month proportion - NHL players vs. Gen Pop\"\n  ) +\n  scale_y_continuous(\n    labels = scales::percent,\n    expand = c(0, 0)\n  ) +\n  labs(\n    caption = \"Data: Statistics Canada, NHL\"\n  ) +\n  ylab(\"NHL % - Gen Pop %\") +\n  xlab(element_blank()) +\n  theme_classic() +\n  theme(\n    axis.ticks.x = element_blank(),\n    axis.ticks.y = element_blank(),\n    text = element_text(size = 13),\n    legend.position = \"bottom\",\n    panel.background = element_rect(fill = \"#fbfae4\"),\n    plot.background = element_rect(fill = \"#fbfae4\"),\n    legend.background = element_rect(fill = \"#fbfae4\")\n  )\n\nplot2\n\n# Save draft\n# ggsave(\n#   here(\"drafts\", paste0(\"plt_\", last_tues), paste0(format(Sys.time(), \"%Y-%m-%d_%H%M%S\"), \".png\")),\n#   plot\n# )\n\ncowplot <- cowplot::plot_grid(plot, plot2, nrow = 2)\ncowplot\n\n# Save final\nplot_title <- \"proportion_comparison\"\nggsave(\n  here(\"2024\", last_tues, paste0(last_tues, \"_\", plot_title, \".png\")), \n  cowplot\n)\n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}